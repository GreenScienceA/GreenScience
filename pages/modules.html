<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Modules â€” Green Science</title>
  <link rel="icon" type="image/svg+xml" href="../SS.svg">
  <meta name="theme-color" content="#0a0f0a">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Noto+Kufi+Arabic:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <noscript><div style="text-align:center;padding:80px 20px;font-family:sans-serif;color:#ccc;background:#0a0f0a;min-height:100vh"><h1 style="color:#2ECC71">Green Science</h1><p>JavaScript is required.</p></div></noscript>
  <div class="bg-layer"><div class="orb orb-1"></div><div class="orb orb-2"></div></div>
  <div class="grain"></div>
  <nav class="nav-bar"><div class="nav-inner">
    <a href="../index.html" class="nav-brand">
      <img src="../SS.svg" width="30" height="30" alt="logo">
      <span data-i18n="siteName">Green Science</span></a>
    <div class="nav-right">
      <button class="theme-btn" onclick="toggleTheme()" aria-label="Toggle theme"><svg class="theme-icon-light" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg class="theme-icon-dark" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button>
      <button class="search-btn" onclick="openSearch()" aria-label="Search"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></button>
      <div class="lang-btns">
        <button class="lang-btn active" onclick="setLang('en')">EN</button>
        <button class="lang-btn" onclick="setLang('fr')">FR</button>
        <button class="lang-btn" onclick="setLang('ar')">Ø¹Ø±Ø¨ÙŠ</button>
      </div>
    </div>
  </div></nav>
  <main class="wrap" id="main"></main>
<script src="../js/config.js"></script>
<script src="../js/i18n.js"></script>
<script src="../js/data.js"></script>
<script src="../js/modules/soil.js"></script>
<script src="../js/modules/plant.js"></script>
<script src="../js/modules/climate.js"></script>
<script src="../js/modules/stat.js"></script>
<script src="../js/modules/ai.js"></script>
<script src="../js/modules/datasci.js"></script>
<script src="../js/modules/writing.js"></script>
<script src="../js/modules/tools.js"></script>
<script src="../js/modules/ecology.js"></script>
<script src="../js/modules/chemistry.js"></script>

<script src="../js/news.js"></script>
<script src="../js/engine.js"></script>
<script src="../js/features.js"></script>
<script>
var modSearch = '', modCatFilter = 'all';
function onLangChange() { render(); }

function render() {
  var el = document.getElementById('main');
  var limit = typeof MODULES_GRID_LIMIT !== 'undefined' ? MODULES_GRID_LIMIT : 12;
  var pinned = getPinnedModules();
  var pinnedCount = pinned ? pinned.length : 0;

  var h = '<div class="breadcrumb"><a href="../index.html">' + tr('backHome') + '</a><span class="sep">â€º</span><span class="current">' + tr('allModulesTitle') + '</span></div>';
  h += '<div class="page-hero"><div class="page-icon" style="background:linear-gradient(135deg,#2ECC71,#27AE60)">ðŸ“¦</div><div><h1 class="page-title">' + tr('allModulesTitle') + '</h1><p class="page-desc">' + modules.length + ' ' + tr('modulesTotal') + '</p></div></div>';

  // Search
  h += '<div class="books-toolbar"><input class="books-search" type="text" placeholder="' + tr('allModulesSearch') + '" value="' + modSearch.replace(/"/g,'&quot;') + '" oninput="modSearch=this.value;renderResults()"></div>';

  // Category filters
  var counts = {};
  modules.forEach(function(m){ var sc = (moduleSuperCategories && moduleSuperCategories[m.id]) || 'other'; counts[sc] = (counts[sc]||0)+1; });
  h += '<div class="books-filters">';
  h += '<button class="books-filter-btn' + (modCatFilter==='all'?' active':'') + '" onclick="modCatFilter=\'all\';renderResults()">ðŸ“‹ ' + tr('catFilterAll') + ' (' + modules.length + ')</button>';
  superCategoryOrder.forEach(function(catId) {
    var c = counts[catId]||0; if (!c) return;
    h += '<button class="books-filter-btn' + (modCatFilter===catId?' active':'') + '" onclick="modCatFilter=\'' + catId + '\';renderResults()">' + superCategoryIcons[catId] + ' ' + tr(superCategoryLabels[catId]) + ' (' + c + ')</button>';
  });
  h += '</div>';

  h += '<div class="pin-info">' + tr('pinnedModules') + ': <strong>' + pinnedCount + '/' + limit + '</strong></div>';
  h += '<div id="modResults"></div>';
  h += '<footer><div id="contactSlot"></div><div style="margin-top:16px">&copy; Ouali Abdelouahad - ÙˆØ§Ù„ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„ÙˆØ§Ø­Ø¯ </div></footer>';
  el.innerHTML = h;
  renderContactLinks();
  renderResults();
}

function renderResults() {
  var container = document.getElementById('modResults');
  if (!container) return;
  var q = modSearch.toLowerCase().trim();
  var filtered = modules.filter(function(m) {
    if (modCatFilter !== 'all') {
      var sc = (moduleSuperCategories && moduleSuperCategories[m.id]) || 'other';
      if (sc !== modCatFilter) return false;
    }
    if (!q) return true;
    var txt = [localText(m.title), localText(m.description), m.id].join(' ').toLowerCase();
    return txt.indexOf(q) !== -1;
  });

  if (filtered.length === 0) {
    container.innerHTML = '<div class="empty-state"><p>' + tr('noModulesFound') + '</p></div>';
    return;
  }

  var pinned = getPinnedModules();
  var sorted = filtered.slice().sort(function(a, b) {
    return localText(a.title).localeCompare(localText(b.title), currentLang);
  });

  var h = '<div class="allmod-grid">';
  sorted.forEach(function(mod) {
    var grad = catGradients[mod.category] || catGradients.general;
    var subC = mod.subModules ? mod.subModules.length : 0;
    var topC = mod.subModules ? mod.subModules.reduce(function(s,sm){ return s+(sm.topics?sm.topics.length:0); },0) : 0;
    var pin = pinned && pinned.indexOf(mod.id) !== -1;

    h += '<div class="allmod-card' + (pin ? ' pinned' : '') + '">';
    h += '<a href="module.html?id=' + mod.id + '" class="allmod-link">';
    h += '<div class="allmod-icon" style="background:' + grad + '">' + mod.icon + '</div>';
    h += '<div class="allmod-info"><div class="allmod-title">' + localText(mod.title) + '</div>';
    h += '<div class="allmod-desc">' + localText(mod.description) + '</div>';
    h += '<div class="allmod-stats">' + subC + ' ' + tr('subModulesLabel').toLowerCase() + ' Â· ' + topC + ' ' + tr('topicsLabel').toLowerCase() + '</div>';
    h += '</div></a>';
    h += '<button class="pin-btn' + (pin ? ' active' : '') + '" onclick="doTogglePin(\'' + mod.id + '\')" title="' + tr(pin ? 'unpinModule' : 'pinModule') + '">';
    h += '<svg viewBox="0 0 24 24" fill="' + (pin ? 'currentColor' : 'none') + '" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
    h += '</button></div>';
  });
  h += '</div>';
  container.innerHTML = h;
}

function doTogglePin(modId) {
  var limit = typeof MODULES_GRID_LIMIT !== 'undefined' ? MODULES_GRID_LIMIT : 12;
  var ok = togglePin(modId);
  if (!ok) { alert(tr('pinLimitMsg')); return; }
  renderResults();
  // Update pin count
  var pinned = getPinnedModules();
  var info = document.querySelector('.pin-info');
  if (info) info.innerHTML = tr('pinnedModules') + ': <strong>' + (pinned ? pinned.length : 0) + '/' + limit + '</strong>';
}

setLang(initLang());
</script>
</body>
</html>
